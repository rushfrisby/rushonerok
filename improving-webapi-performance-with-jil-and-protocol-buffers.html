<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Improving WebAPI performance with Jil and Protocol Buffers</title>
<meta name="HandheldFriendly" content="True" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="/css/screen.css" />
<link rel="stylesheet" type="text/css" href="/css/webkid.css" />
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
<meta property="og:site_name" content="Rush Frisby" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Improving WebAPI performance with Jil and Protocol Buffers" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Improving WebAPI performance with Jil and Protocol Buffers" />
<meta name="twitter:label1" content="Written by" />
<meta name="twitter:data1" content="Rush Frisby" />
<!--<link rel="alternate" type="application/rss+xml" title="Rush Frisby's Blog" href="https://rushfrisby.com/rss/" />-->
</head>
<body class="post-template">
<link rel="stylesheet" href="/css/prism.css">
<script src="/js/prism.js" type="text/javascript"></script>
<header id="header">
<nav class="header-nav" ">
<div class="blog-title"><a href="/">Rush Frisby</a></div>
<div class="blog-description">Thoughts on software and technology.</div>

<div class="taglist-wrapper clearfix">
<ul id="taglist" class="taglist">
<li class="nav-home" role="presentation">
<a href="/">Home</a>
</li>
<li class="nav-about" role="presentation">
<a href="/about">About</a>
</li>
<li class="nav-mechanical-keyboards" role="presentation">
<a href="/mechanical-keyboards">Mechanical Keyboards</a>
</li>
<li class="nav-about" role="presentation">
<a href="/tags">Tags</a>
</li>
<li class="nav-about" role="presentation">
<a href="/archive">Archive</a>
</li>
</ul>
</div>
</nav>
</header>
<main id="content" class="content" role="main">
<div id="article" class="box ">
<article class='post'>
<header class='post-header'>
<a href='/improving-webapi-performance-with-jil-and-protocol-buffers'><h1 class='post-title'>Improving WebAPI performance with Jil and Protocol Buffers</h1></a>
<section class='post-meta'>
<time class='post-date' datetime='2014-10-17'>Friday, October 17, 2014</time>
</section>
</header>
<section class='post-content'>
<p>One of the reasons I don’t use WebAPI for internal services is because of the performance hit incurred when serializing and deserializing JSON and XML messages. Even for public API’s this is somewhat of a pain. After digging around I’ve found ways to improve the performance of WebAPI serialization.</p>

<p>In .NET there are lots of serializers. The most popular being <a href="http://james.newtonking.com/json">Json.NET</a> which was chosen by Microsoft to be the default JSON serializer for WebAPI. Json.NET is great because it is fast, robust, and configurable. There are serializers that are <strong>faster</strong> than Json.NET though. Take a look at <a href="http://theburningmonk.com/2014/02/json-serializers-benchmarks-updated/">these benchmarks</a>:</p>

<p><img src="/content/images/2016/04/serializer_benchmarks.png" alt="Source: theburningmonk.com" /></p>

<p><img src="/content/images/2016/04/serializer_benchmarks2.png" alt="Source: theburningmonk.com" /></p>

<p></div>ServiceStack.Text, Jil, and Protobuf-Net are all faster than Json.NET. Protobuf-Net is not a JSON serializer but I’ll get to that in a minute. ServiceStack.Text slightly edges out Json.NET in terms of speed and from what I can tell is as robust as Json.NET. I frown upon using it however because it’s not entirely free. There is a free version but it will only deserialize 10 object types and serialize 20. I will never use it because of this. Json.NET is free and the performance gain in using ServiceStack isn’t enough for me to pay.</p>

<p>There is one more option we need to look at though – <a href="https://github.com/kevin-montrose/Jil">Jil</a>. Jil is optimized for speed over memory. The author of Jil goes into detail on <a href="http://kevinmontrose.com/">his blog</a> on the optimizations he’s made to get the best performance. It is interesting reading if you have time. Jil is also used on the <a href="https://api.stackexchange.com/">Stack Exchange API</a> which is used by many people. I almost forgot to mention – it’s free!</p>

<p><a href="https://code.google.com/p/protobuf/">Protocol Buffers</a>, or Protobuf for short, is Google’s official serializer. They use it for all of their internal services. Instead of JSON this is a binary serializer. I was interested to see the payload size of binary serialization versus JSON so I did a quick test. Json.NET produced a payload of 728 bytes while the same object serialized by Protobuf was 444 bytes (39% smaller). The act of serialization is also faster as you can see in the benchmarks above. The combination of the two means you can receive and send WebAPI messages faster than the default serializer. But how can we use this in WebAPI?</p>

<p>The great thing about WebAPI is that swapping out serializers and adding support for new ones is a breeze. In my projects I am now swapping out Json.NET for Jil and adding support for protobuf. WebAPI will return the correct result to the caller based on the content-type they wish to receive. Here are some articles on how you can do this too!</p>

<ul>
<li><a href="http://www.strathweb.com/2013/02/asp-net-web-api-and-protocol-buffers/">Implementing protocol-buffers in WebAPI</a></li>
<li><a href="http://damienbod.wordpress.com/2014/01/11/using-protobuf-net-media-formatter-with-web-api-2/">Consuming protobuf services</a></li>
<li><a href="https://code.google.com/p/protobuf-net/">Protobuf-net project</a></li>
</ul>
</section>
<footer class='post-footer'>
</footer>
<div id="disqus_thread">
	<iframe id="dsq-app9441" name="dsq-app9441" allowtransparency="true" scrolling="no" tabindex="0" title="Disqus" style="width: 1px !important; min-width: 100% !important; border: medium none !important; overflow: hidden !important; height: 727px !important;" src="https://disqus.com/embed/comments/?base=default&amp;f=rushfrisby&amp;t_i=&amp;t_u=https%3A%2F%2Frushfrisby.com%2Finterface-to-rpc-service%2F&amp;t_d=Interface%20to%20RPC%20Service&amp;t_t=Interface%20to%20RPC%20Service&amp;s_o=default#version=f51929c5205670fde13c1721baf9ca15" horizontalscrolling="no" verticalscrolling="no" width="100%" frameborder="0"></iframe>
</div>
<script type="text/javascript">
    var disqus_shortname = 'rushfrisby'; // required: replace example with your forum shortname
    var disqus_identifier = '';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script');
		dsq.type = 'text/javascript';
		dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>

</div>
<div id="sidebar"><div class="box sidebox about">
<div class="sidebox-title">About</div>
<div class="sidebox-content">
<p class="center"><img src="/img/rush_headshot_2018_256-min.jpg" title="Rush Frisby" alt="Rush Frisby" width="256" height="256" /></p>
<p>Rush is a software architect who loves solving problems. You'll usually find him writing about security concepts and sharing solutions to problems he's faced.</p>
</div>
</div>
<div class="sidebox box social clearfix">
<ul>
<a href="/rss" target="_blank" class="social-item rss"><li><i class="fa fa-rss"></i></li></a>
<a href="https://twitter.com/rushonerok" target="_blank" class="social-item tw"><li><i class="fa fa-twitter"></i></li></a>
<a href="http://github.com/rushfrisby" class="social-item github"><li><i class="fa fa-github"></i></li></a>
<a href="/" class="social-item home"><li><i class="fa fa-home"></i></li></a>
</ul>
</div>
<div class='box sidebox latest-articles'>
<div class='sidebox-title'>Latest Articles</div>
<div class='sidebox-content'>
<a href='/interface-to-rpc-service'><div class='date'>2 AUG 2018</div><div>Interface to RPC Service</div></a>
<a href='/losing-our-memory'><div class='date'>8 DEC 2017</div><div>Losing Our Memory</div></a>
<a href='/are-coding-bootcamps-worth-it'><div class='date'>20 AUG 2017</div><div>Are Coding Bootcamps Worth It?</div></a>
<a href='/meetup-using-protobuf-in-net'><div class='date'>8 AUG 2017</div><div>Meetup: Using Protobuf in .NET</div></a>
<a href='/application-security-and-single-sign-on'><div class='date'>16 DEC 2016</div><div>Application Security and Single Sign On</div></a>
</div>
</div>

</main>
<footer class="site-footer clearfix">
<section class="copyright"><a href="https://rushfrisby.com">Rush Frisby</a> &copy; 2018</section>
<section class="poweredby">Proudly published with my own blog engine</section>
</footer>
<script type="text/javascript">
var links = document.links;
for (var i = 0, linksLength = links.length; i < linksLength; i++) {
   if (links[i].hostname != window.location.hostname) {
       links[i].target = '_blank';
   } 
}
</script>
<script type="text/javascript" src="/js/jquery.min.js?v=800fecc11f"></script>
<script type="text/javascript" src="/js/jquery.fitvids.js?v=800fecc11f"></script>
<script type="text/javascript" src="/js/jquery.xml2json.js?v=800fecc11f"></script>
<script type="text/javascript" src="/js/index.js?v=800fecc11f"></script>
<script type="text/javascript" src="/js/webkid.js?v=800fecc11f"></script>
</body>
</html>
